#!/usr/bin/env bash

cd "$(dirname "$0")" && source .lib/barerc || exit 1

[[ $1 == '--version' || $1 == '-v' ]] && echo "$BARE_VERSION" && exit 0

[[ $1 == '--upgrade' ]] && git pull origin root

[[ $1 == '--setup' ]] && {
	bash .lib/setup
	exit 0
}

[[ -z $1 ]] && exit 0

# Check if the -I flag is provided for interactive mode

case $1 in

	-[iI]|-[tT]|terminal|--terminal) # i = interactive / t = terminal

		shift && exec bash --rcfile <(cat << EOF

			# put all bare commands in primary context
			PATH="$BARE_DIR:\$PATH"

			# tell Macs to be quiet about their zsh default
			export BASH_SILENCE_DEPRECATION_WARNING=1

			if [[ "$BARE_COLOR" == 1 ]]; then
				GREEN='\\033[0;32m'
				YELLOW='\\033[0;33m'
				GRAY='\\033[2;37m'
				RESET='\\033[0m'
			fi

			PS1="ðŸ» \[\${GREEN}\]\$(basename \$(pwd)) \[\${YELLOW}\]> \[\${RESET}\]"

			printf "\n\${GRAY}entering bare terminal. type exit when ready to leave.\${RESET}\n"

EOF
		);

		;;

	*) script_name="$1" && shift && ./"$script_name" "$@"

esac
